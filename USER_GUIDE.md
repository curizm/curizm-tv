# 큐리즘 TV 연결 시스템 사용 가이드

## 개요
큐리즘 TV 연결 시스템은 전시회나 이벤트에서 여러 대의 TV를 동시에 제어할 수 있는 시스템입니다. 모바일 기기로 TV를 설정하고, 웹 기반 컨트롤러로 전시 콘텐츠를 관리할 수 있습니다.

## 플랫폼 지원

### Android TV 앱 (권장)
- **네이티브 Android TV 앱**: 최적화된 성능과 안정성
- **QR 코드 자동 생성**: TV에서 직접 QR 코드 표시
- **실시간 WebSocket 연결**: 빠른 명령 전달
- **HLS 비디오 스트리밍**: ExoPlayer 기반 고품질 재생
- **자막 지원**: SRT, VTT 형식 지원
- **배경음악**: 별도 오디오 트랙 재생
- **TV 최적화**: 리모컨 제어, 전체화면 재생

### 웹 브라우저 (대안)
- **호환성**: 대부분의 스마트 TV 브라우저 지원
- **설치 불필요**: 브라우저에서 직접 접속
- **제한사항**: 성능과 안정성이 Android 앱 대비 낮음

## 사용 방법

### 1. TV 설정

#### Android TV 앱 사용 (권장)
1. **앱 설치**: Google Play Store에서 "Curizm TV" 설치
2. **앱 실행**: TV에서 앱을 실행하면 QR 코드 화면이 표시됨
3. **모바일 연결**: 모바일에서 QR 코드 스캔 또는 6자리 코드 입력
4. **자동 전환**: 설정 완료 후 자동으로 비디오 수신 모드로 전환

#### 웹 브라우저 사용 (대안)
1. TV 브라우저에서 `/qr` 페이지 접속
2. QR 코드 또는 6자리 코드 확인
3. 모바일에서 `/connect` 페이지 접속
4. 코드, 회사명, 비밀번호 입력
5. "TV에서 전시 시작" 버튼 클릭

### 2. TV 제어 (웹 컨트롤러)

#### 접속 방법
- URL: `/tv/controller.html?companyName=회사명&secretCode=비밀번호`
- 또는 모바일 설정 완료 후 자동 리다이렉트

#### 테스트용 수신기 (선택사항)
- **URL**: `/tv/receiver.html?companyName=회사명&secretCode=비밀번호`
- **용도**: 노트북 브라우저에서 TV 기능을 테스트할 때 사용
- **주의**: 실제 TV가 아닌 테스트 목적으로만 사용

#### 주요 기능

**방 연결**
- 회사명과 비밀번호로 방에 연결
- 연결 상태와 방 정보 표시

**플레이리스트 관리**
- "데이터 로드" 버튼으로 전시 콘텐츠 불러오기
- "TV로 전송" 버튼으로 TV에 플레이리스트 전송
- 플레이리스트 아이템 클릭으로 해당 항목으로 이동

**재생 제어**
- 동기화 시작: 모든 TV에서 동시에 재생 시작
- 재생/일시정지: 재생 상태 제어
- 이전/다음: 플레이리스트 항목 이동

**오디오 및 디스플레이 설정**
- 비디오 볼륨 조절 (0-100%)
- 배경음악 볼륨 조절 (0-100%)
- 자막 켜기/끄기
- 연결된 TV 상태 모니터링

## Android TV 앱 상세 기능

### QR 설정 화면
- **QR 코드 자동 생성**: 3분마다 갱신되는 QR 코드
- **6자리 연결 코드**: QR 스캔이 어려운 경우 대안 제공
- **실시간 상태 표시**: 연결 상태와 타이머 표시
- **자동 재연결**: 연결 실패 시 자동 재시도

### 비디오 수신 화면
- **전체화면 비디오 재생**: HLS 스트림 지원
- **작품 정보 오버레이**: 제목, 작가, 크기, 재료 정보 표시
- **상태 표시**: 방 정보, 연결 상태, 재생 중인 항목 번호
- **자동 UI 숨김**: 재생 중 UI 요소 자동 숨김

### 리모컨 제어
- **Konami 코드 리셋**: ↑↑↓↓←→←→ 순서로 리셋
- **설정 초기화**: QR 설정 화면으로 돌아가기
- **자동 저장**: 설정 정보 자동 저장으로 재시작 시 바로 사용

### 고급 기능
- **자막 지원**: SRT, VTT 형식 자막 자동 감지
- **배경음악**: 비디오와 별도 오디오 트랙 재생
- **볼륨 제어**: 비디오와 배경음악 개별 볼륨 조절
- **플레이리스트 관리**: 실시간 플레이리스트 업데이트

## 문제 해결

### 일반적인 문제

**TV가 연결되지 않음**
- 회사명과 비밀번호가 정확한지 확인
- 네트워크 연결 상태 확인
- TV 브라우저가 최신 버전인지 확인
- Android TV 앱 사용 시: 앱을 완전히 종료 후 재시작

**플레이리스트가 로드되지 않음**
- 회사명과 비밀번호가 올바른지 확인
- 인터넷 연결 상태 확인
- 페이지를 새로고침해보기
- Android TV 앱 사용 시: WebSocket 연결 상태 확인

**TV에서 비디오가 재생되지 않음**
- TV 브라우저가 비디오 재생을 지원하는지 확인
- 비디오 파일이 손상되지 않았는지 확인
- 다른 브라우저로 시도해보기
- Android TV 앱 사용 시: ExoPlayer 로그 확인

### Android TV 앱 특별 문제

**앱이 시작되지 않음**
- Android 7.0 (API 24) 이상인지 확인
- Google Play Services가 설치되어 있는지 확인
- 앱 권한이 올바르게 설정되었는지 확인

**QR 코드가 표시되지 않음**
- 인터넷 연결 상태 확인
- API 서버 상태 확인
- 앱을 완전히 종료 후 재시작

**비디오가 재생되지 않음**
- HLS 스트림 URL이 유효한지 확인
- 네트워크 대역폭이 충분한지 확인
- 다른 비디오 파일로 테스트

**자막이 표시되지 않음**
- 자막 파일 URL이 유효한지 확인
- 자막 파일 형식이 SRT 또는 VTT인지 확인
- 자막 설정이 켜져 있는지 확인

## 연락처 및 지원

**시스템 관리자**: [관리자 연락처]
**개발팀**: [개발팀 연락처]
**긴급 지원**: [긴급 연락처]

---

## 기술적 세부사항 (참고용)

### 시스템 아키텍처

#### 주요 구성 요소
1. **모바일 설정 페이지** (`/connect`) - TV 연결 설정
2. **TV 수신기** (`/tv/receiver.html`) - TV에서 실행되는 화면
3. **웹 컨트롤러** (`/tv/controller.html`) - TV 제어 인터페이스
4. **QR 코드 페이지** (`/qr`) - TV에 QR 코드 표시
5. **Android TV 앱** - 네이티브 TV 애플리케이션
6. **WebSocket 서버** - 실시간 통신

#### Android TV 앱 구조
1. **MainActivity**: 앱 시작점, 설정 상태 확인
2. **QRSetupActivity**: QR 코드 생성 및 연결 대기
3. **VideoReceiverActivity**: 비디오 재생 및 제어 수신

#### 색상 스키마
- **배경색**: `#352B2B` (어두운 회색)
- **주요 텍스트/액센트**: `#FF5935` (오렌지)
- **보조 텍스트**: `#FFFBE9` (크림색)

### WebSocket 통신
- **서버**: `wss://api.curizm.io/`
- **이벤트**:
  - `HELLO`: 클라이언트 등록
  - `SET_PLAYLIST`: 플레이리스트 설정
  - `COMMAND`: 재생 제어 명령
  - `ROOM_STATE`: 방 상태 업데이트
  - `RECEIVER_STATUS`: TV 상태 업데이트
  - `HEARTBEAT`: 상태 주기적 전송 (Android 앱)

### API 엔드포인트
- **플레이리스트 조회**: `GET /api/v1/exhibition/tv?companyName={name}&secretCode={code}`
- **TV 설정**: `POST /api/v1/tv/setup`
- **세션 생성**: `POST /api/v1/tv/generate-session` (Android 앱)

### 파일 구조
```
apps/curizm-service/
├── public/tv/
│   ├── controller.html    # 웹 컨트롤러
│   ├── controller.js      # 컨트롤러 로직
│   ├── receiver.html      # TV 수신기
│   └── receiver.js        # 수신기 로직
├── src/routes/
│   ├── connect.tsx        # 모바일 설정 페이지
│   └── qr.tsx            # QR 코드 페이지

curizm-tv/ (Android 앱)
├── app/src/main/java/io/curizm/tv/
│   ├── MainActivity.kt           # 앱 시작점
│   ├── QRSetupActivity.kt        # QR 설정 화면
│   └── VideoReceiverActivity.kt  # 비디오 재생 화면
├── app/src/main/res/
│   ├── layout/                   # UI 레이아웃
│   ├── drawable/                 # 이미지 리소스
│   └── values/                   # 색상, 테마
```

### Android TV 앱 기술 스택
- **ExoPlayer**: HLS 비디오 스트리밍
- **Socket.IO**: WebSocket 통신
- **ZXing**: QR 코드 생성
- **OkHttp**: HTTP 요청
- **Gson**: JSON 파싱

### 디버깅 방법

**웹 컨트롤러**
- 브라우저 개발자 도구 콘솔 확인
- WebSocket 연결 상태 모니터링
- 네트워크 탭에서 API 요청 확인

**TV 수신기**
- TV 브라우저 콘솔 확인 (가능한 경우)
- URL 파라미터 확인: `?companyName=xxx&secretCode=xxx`
- WebSocket 연결 상태 확인

**Android TV 앱**
- Android Studio Logcat에서 로그 확인
- WebSocket 연결 상태 모니터링
- ExoPlayer 재생 상태 확인
- 네트워크 요청 로그 확인

### 유지보수

#### 정기 점검 사항
- WebSocket 서버 상태 확인
- API 서버 응답 시간 모니터링
- TV 브라우저 호환성 테스트
- Android TV 앱 안정성 확인
- 네트워크 연결 안정성 확인

#### 업데이트 시 주의사항
- 색상 스키마 변경 시 모든 페이지에 일관성 유지
- WebSocket 이벤트 구조 변경 시 호환성 확인
- API 엔드포인트 변경 시 프론트엔드 코드 동기화
- Android 앱 업데이트 시 Google Play Store 배포 프로세스 준수

---

*이 문서는 2025년 기준으로 작성되었으며, 시스템 업데이트에 따라 내용이 변경될 수 있습니다.*
